!function(a){"use strict";function b(){function a(a,b){this.timeout=a,this.launched=!1,this.callback=null,void 0===b?this.updateFunction=!0:this.updateFunction=b,console.log("this.updateFunction",this.updateFunction)}function b(a){this.callback=a}function c(){this.launched=!1,this.callback()}function d(a){var b=this;(this.updateFunction||null===this.callback)&&this.updateCallback(a),this.launched||(this.launched=!0,setTimeout(function(){b.callCallback()},this.timeout))}return a.prototype.updateCallback=b,a.prototype.callCallback=c,a.prototype.callOnce=d,a}function c(a){function b(b){var c=a.selection.getNode(),g=a.dom.create("input",{type:"checkbox"}),h=d("Saisir un label pour la case à chocher"),i=e("Voulez-vous placer le label avant la case (annuler pour le placer après) ?"),j=a.dom.create("label",null,h);a.dom.setAttrib(j,"contenteditable",!1),i?f(g).appendTo(j):f(g).prependTo(j),a.dom.add(c,j),a.nodeChanged()}function c(b){b.preventDefault(),console.log(this,b);var c=f(this),d=!!c.attr("checked"),e=c.clone();console.log("toggle",d,!d),e.attr("checked",!d),e.insertAfter(c),c.remove(),a.nodeChanged(),a.fire("change"),a.fire("SetContent")}function g(){f(":checkbox",a.getDoc()).each(function(){var a=this,b=f(this).parent().get(0);"LABEL"!==b.tagName&&(b=f("<label>"),f(a).wrap(b)),f(b).off("click").on("click",function(b){c.call(a,b)})})}function i(b){function c(){var b=f("input[type=checkbox]",a.getDoc());b.filter(function(){return"LABEL"===f(this).parent()[0].nodeName}).parent().attr("contenteditable",!1),b.filter(function(){return"LABEL"!==f(this).parent()[0].nodeName}).wrap(f("label").attr("contenteditable",!1))}setTimeout(c,200)}var j=new h(150);a.on("init NodeChange change SetContent",function(){j.callOnce(g)}),a.on("init",i),a.addMenuItem("forminputs",{separator:"before",text:"Form",context:"insert",menu:[{text:"Checkbox",onclick:b,onPostRender:null}]})}var d=a.prompt,e=a.confirm,f=a.$,g=a.tinymce;g.PluginManager.add("forminputs",c);var h=b()}(window);