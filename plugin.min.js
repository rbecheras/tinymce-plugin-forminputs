!function(a){"use strict";function b(){function a(a,b){this.timeout=a,this.launched=!1,this.callback=null,void 0===b?this.updateFunction=!0:this.updateFunction=b,console.log("this.updateFunction",this.updateFunction)}function b(a){this.callback=a}function c(){this.launched=!1,this.callback()}function d(a){var b=this;(this.updateFunction||null===this.callback)&&this.updateCallback(a),this.launched||(this.launched=!0,setTimeout(function(){b.callCallback()},this.timeout))}return a.prototype.updateCallback=b,a.prototype.callCallback=c,a.prototype.callOnce=d,a}function c(a){function b(a){console.info("Binding of merge fields and checkbox values enabled"),l=!!a}function c(){var b=a.selection.getNode(),c=a.dom.create("input",{type:"checkbox"}),e=i(c);c.indeterminate=!0;var f,j,k=a.dom.create("label",null),m=i(k),n=g("Saisir un label pour la case à chocher"),o=h("Voulez-vous placer la case devant le label ?");l&&(f=h("Voulez-vous que cette case à cocher soit vérouillée par un champ de fusion ?"),f&&(j=g("Quel est le code du champ de fusion a associer ?"))),f&&(e.attr("data-merge-field-code",j),m.addClass("disabled-element"));var p="input-checkbox-"+Date.now();m.attr("for",p),e.attr("id",p);var q=a.selection.getNode(),r=d(q,"Calibri","12pt",a),s=i("<span>").html(n).attr("contenteditable",!1).css(r);s.appendTo(m),a.dom.setAttrib(k,"contenteditable",!1),o?e.appendTo(k):e.prependTo(k),a.dom.add(b,k)}function e(b){b.preventDefault();var c=i(this);if(!c.attr("data-merge-field-code")){c.attr("checked")?c.removeAttr("checked"):c.attr("checked","checked"),a.setContent(a.getContent()),a.focus();var d=i("#"+c.attr("id"),a.getDoc()),e=d.parent("label"),f=e.length?d.get(0):e.get(0);a.selection.select(f),a.selection.collapse(!0)}}function f(){i(":checkbox",a.getDoc()).each(function(){var b=this,c=i(this).parent().get(0);"LABEL"!==c.tagName&&(c=i("<label>"),i(b).wrap(c)),i(c).off("click").on("click",function(c){a.undoManager.transact(e.bind(b,c))})})}function j(b){function c(){var b=i("input[type=checkbox]",a.getDoc());b.filter(function(){return"LABEL"===i(this).parent()[0].nodeName}).parent().attr("contenteditable",!1),b.filter(function(){return"LABEL"!==i(this).parent()[0].nodeName}).wrap(i("label").attr("contenteditable",!1))}setTimeout(c,200)}var l=!1;this.enableMergeFieldBinding=b.bind(this,!0),this.disableMergeFieldBinding=b.bind(this,!1);var m=new k(150);a.on("init NodeChange change SetContent",function(){m.callOnce(f)}),a.on("init",j),a.addMenuItem("forminputs",{separator:"before",text:"Form",context:"insert",menu:[{text:"Checkbox",onclick:function(b){a.undoManager.transact(c)},onPostRender:null}]})}function d(a,b,c,d){var g,h,j,k=i(a);if(g=k.filter(e),g.length)j=g;else{var l=i("*",d.getDoc()),m=l.index(a),n=i("span",d.getDoc()).filter(e),o=n.map(function(a,b){return l.index(b)}),p=[],q=[];i.each(o,function(a,b){m>b?p.push(b):b>m&&q.push(b)});var r=Math.max.apply(null,p),s=Math.min.apply(null,q);!isNaN(r)&&isFinite(r)?h=l[r]:!isNaN(s)&&isFinite(s)&&(h=l[s]),h&&(j=i(h))}return j?f(j):{fontFamily:b,fontSize:c}}function e(){return this.style.fontFamily&&this.style.fontSize}function f(a){return{fontFamily:a[0].style.fontFamily,fontSize:a[0].style.fontSize}}var g=a.prompt,h=a.confirm,i=a.$,j=a.tinymce;j.PluginManager.add("forminputs",c);var k=b()}(window);